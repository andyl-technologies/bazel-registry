diff --git a/MODULE.bazel b/MODULE.bazel
index dffb979..86cc8ec 100644
--- a/MODULE.bazel
+++ b/MODULE.bazel
@@ -6,6 +6,7 @@ module(
     compatibility_level = 1,
 )
 
+bazel_dep(name = "apple_support", version = "1.17.1")
 bazel_dep(name = "bazel_features", version = "1.21.0")
 bazel_dep(name = "bazel_skylib", version = "1.7.1")
 bazel_dep(name = "platforms", version = "0.0.11")
diff --git a/foreign_cc/private/framework.bzl b/foreign_cc/private/framework.bzl
index 76192ef..bacc4f1 100644
--- a/foreign_cc/private/framework.bzl
+++ b/foreign_cc/private/framework.bzl
@@ -1,7 +1,11 @@
 """ Contains definitions for creation of external C/C++ build rules (for building external libraries
  with CMake, configure/make, autotools)
+
+NOTE: Do NOT use env vars (DEVELOPER_DIR/SDKROOT) for custom SDK paths.
+      Instead, use the XcodeSdkVariantInfo provider from apple_support.
 """
 
+load("@apple_support//xcode:providers.bzl", "XcodeSdkVariantInfo")
 load("@bazel_features//:features.bzl", "bazel_features")
 load("@bazel_skylib//lib:collections.bzl", "collections")
 load("@bazel_skylib//lib:paths.bzl", "paths")
@@ -243,6 +247,9 @@ CC_EXTERNAL_RULE_ATTRIBUTES = {
     "_cc_toolchain": attr.label(
         default = Label("@bazel_tools//tools/cpp:current_cc_toolchain"),
     ),
+    "_xcode_config": attr.label(
+        default = Label("@@//bazel/xcode:xcode_config"),
+    ),
     "_foreign_cc_framework_platform": attr.label(
         doc = "Information about the execution platform",
         cfg = "exec",
@@ -338,24 +345,46 @@ def get_env_prelude(ctx, installdir, data_dependencies, tools_env):
     cc_env = _correct_path_variable(cc_toolchain, get_env_vars(ctx))
     env.update(cc_env)
 
+    # Add all user defined variables FIRST so we can check for DEVELOPER_DIR/SDKROOT
+    user_vars = expand_locations_and_make_variables(ctx, ctx.attr.env, "env", data_dependencies)
+    env.update(user_vars)
+
     # This logic mirrors XcodeLocalEnvProvider#querySdkRoot in bazel itself
+    # Check for custom SDK paths from xcode_config's XcodeSdkVariantInfo provider
     if "APPLE_SDK_PLATFORM" in cc_env:
         platform = cc_env["APPLE_SDK_PLATFORM"]
         version = cc_env["APPLE_SDK_VERSION_OVERRIDE"]
         sdk = "{}{}".format(platform.lower(), version)
-        env_snippet.extend([
-            # TODO: This path needs to take cc_env["XCODE_VERSION_OVERRIDE"] into account
-            # Declare and export separately so bash doesn't ignore failures from the commands https://github.com/koalaman/shellcheck/wiki/SC2155
-            "developer_dir_tmp=\"$(xcode-select --print-path)\"",
-            "export DEVELOPER_DIR=\"$developer_dir_tmp\"",
-            "sdkroot_tmp=\"$(xcrun --sdk {} --show-sdk-path)\"".format(sdk),
-            "export SDKROOT=\"$sdkroot_tmp\"",
-            "export CMAKE_OSX_ARCHITECTURES={}".format(ctx.fragments.apple.single_arch_cpu),
-        ])
-
-    # Add all user defined variables
-    user_vars = expand_locations_and_make_variables(ctx, ctx.attr.env, "env", data_dependencies)
-    env.update(user_vars)
+
+        # Try to get custom SDK paths from xcode_config's XcodeSdkVariantInfo provider
+        # NOTE: Do NOT use env vars - use the provider instead
+        custom_developer_dir = None
+        custom_sdk_root = None
+        if hasattr(ctx.attr, "_xcode_config"):
+            xcode_config_target = ctx.attr._xcode_config
+            if XcodeSdkVariantInfo in xcode_config_target:
+                sdk_variant_info = xcode_config_target[XcodeSdkVariantInfo]
+                custom_developer_dir = sdk_variant_info.developer_dir
+                custom_sdk_root = sdk_variant_info.sdk_root
+
+        # Use custom paths if available, otherwise fall back to xcode-select/xcrun
+        if custom_developer_dir:
+            env_snippet.append("export DEVELOPER_DIR=\"{}\"".format(custom_developer_dir))
+        else:
+            env_snippet.extend([
+                "developer_dir_tmp=\"$(xcode-select --print-path)\"",
+                "export DEVELOPER_DIR=\"$developer_dir_tmp\"",
+            ])
+
+        if custom_sdk_root:
+            env_snippet.append("export SDKROOT=\"{}\"".format(custom_sdk_root))
+        else:
+            env_snippet.extend([
+                "sdkroot_tmp=\"$(xcrun --sdk {} --show-sdk-path)\"".format(sdk),
+                "export SDKROOT=\"$sdkroot_tmp\"",
+            ])
+
+        env_snippet.append("export CMAKE_OSX_ARCHITECTURES={}".format(ctx.fragments.apple.single_arch_cpu))
 
     if cc_toolchain.compiler == "msvc-cl":
         # Convert any $$EXT_BUILD_ROOT$$ or $EXT_BUILD_ROOT in PATH to
